<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Deployment Topology — Development & Production</title>
  <style>
    :root{
      --bg:#fbfdff; --card:#fff; --muted:#6b7280; --accent:#0ea5a4; --accent-2:#7c3aed; --stroke:#e6eef8;
      --shadow: 0 8px 30px rgba(15,23,42,0.06);
    }
    body{font-family:Inter,Segoe UI,Arial,sans-serif;background:var(--bg);margin:18px;color:#0b1220}
    h1{font-size:18px;margin:8px 0}
    .note{font-size:13px;color:var(--muted);margin-bottom:12px}
    .frame{width:100%;max-width:1200px;background:linear-gradient(180deg,#ffffff, #fcfdff);border-radius:10px;padding:18px;border:1px solid var(--stroke)}
    svg{width:100%;height:520px;display:block}
    .lane-title{font-weight:700;fill:#0b1220}
    .small{font-size:12px;fill:var(--muted)}
    .dev-small{font-size:11px;fill:var(--muted)}
    .box{fill:var(--card);stroke:#dfe9f3;stroke-width:1.2;rx:8;}
    .box-strong{fill:var(--card);stroke:#cfdff0;stroke-width:1.6;rx:8;}
    .pill{fill:#f7fbfb;stroke:var(--stroke);rx:8}
    .badge{font-size:11px;fill:#fff}
    .ci{fill:linear-gradient(#7c3aed,#0ea5a4)}
  </style>
</head>
<body>
  <div class="frame">
    <h1>Deployment Topology — Development (bottom) & Production-ish (top)</h1>
    <div class="note">Diagram shows CI/CD, Internet traffic flow, cluster node pools, shared services and a local compose lane. Open in a browser; copy SVG into docs.</div>

    <svg viewBox="0 0 1280 560" role="img" aria-label="Deployment topology diagram">
      <!-- Background lanes -->
      <rect x="30" y="40" width="1140" height="220" rx="10" fill="#eef4ff" stroke="#dfeefb"/>
      <text x="50" y="60" class="lane-title">Production-ish (Kubernetes cluster)</text>

      <rect x="30" y="290" width="1140" height="180" rx="10" fill="#f1fff2" stroke="#e6f7ea"/>
      <text x="50" y="310" class="lane-title">Development (Docker Compose / local)</text>

      <!-- Production: clear, straight layout with numbered arrows -->
      <!-- CI/CD and Registry -->
      <g>
        <rect x="60" y="150" width="90" height="44" rx="8" class="box"/>
        <text x="105" y="178" text-anchor="middle" class="small">CI/CD</text>

        <rect x="180" y="150" width="140" height="44" rx="8" class="box"/>
        <text x="250" y="178" text-anchor="middle" class="small">Image Registry</text>

        <!-- Ingress -->
        <rect x="360" y="120" width="180" height="64" class="box"/>
        <text x="450" y="148" text-anchor="middle" class="small" style="font-weight:700">Ingress</text>
        <text x="450" y="164" text-anchor="middle" class="small">TLS + external auth</text>

        <!-- Node pools -->
        <rect x="560" y="100" width="240" height="120" class="box"/>
        <text x="680" y="124" text-anchor="middle" class="small" style="font-weight:700">Node pool — General</text>
        <text x="680" y="140" text-anchor="middle" class="small">API, Frontend, DB</text>

        <rect x="840" y="100" width="220" height="120" class="box"/>
        <text x="950" y="124" text-anchor="middle" class="small" style="font-weight:700">Node pool — GPU</text>
        <text x="950" y="140" text-anchor="middle" class="small">Model serving (GPU)</text>

        <rect x="1100" y="100" width="160" height="120" class="box"/>
        <text x="1180" y="124" text-anchor="middle" class="small" style="font-weight:700">Shared</text>
        <text x="1180" y="140" text-anchor="middle" class="small">Prometheus, Logging, Vault,</text>
        <text x="1180" y="156" text-anchor="middle" class="small">Backups</text>

        <!-- arrows and numbered badges (positioned above lines to avoid overlap) -->
        <defs>
          <marker id="arrow2" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
            <path d="M 0 0 L 10 5 L 0 10 z" fill="#0ea5a4" />
          </marker>
           <marker id="arrow-dark" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
             <path d="M 0 0 L 10 5 L 0 10 z" fill="#1f2937" />
           </marker>
        </defs>

        <!-- 1: CI/CD -> Registry -->
        <line x1="150" y1="172" x2="180" y2="172" stroke="#0ea5a4" stroke-width="2" marker-end="url(#arrow2)" />
        <circle cx="165" cy="164" r="10" fill="#0ea5a4" />
        <text x="165" y="167" text-anchor="middle" class="badge">1</text>

        <!-- 2: Registry -> Ingress (deploy) -->
        <line x1="320" y1="172" x2="360" y2="152" stroke="#0ea5a4" stroke-width="2" marker-end="url(#arrow2)" />
        <circle cx="340" cy="163" r="10" fill="#0ea5a4" />
        <text x="340" y="166" text-anchor="middle" class="badge">2</text>

        <!-- 3: Internet -> Ingress (above layout, rerouted arc) -->
        <rect x="6" y="-12" width="88" height="28" rx="8" class="box"/>
        <text x="50" y="6" text-anchor="middle" class="small">Internet</text>
        <path d="M 94 10 C 180 40 260 80 360 132" stroke="#1f2937" stroke-width="1.6" stroke-linecap="round" fill="none" marker-end="url(#arrow-dark)" stroke-opacity="0.98" />
        <circle cx="360" cy="132" r="10" fill="#1f2937" />
        <text x="360" y="135" text-anchor="middle" class="badge">3</text>

        <!-- 4: Ingress -> API (Node pool General) straight -->
        <line x1="540" y1="152" x2="560" y2="152" stroke="#7c3aed" stroke-width="2" marker-end="url(#arrow2)" />
        <circle cx="550" cy="146" r="10" fill="#7c3aed" />
        <text x="550" y="149" text-anchor="middle" class="badge">4</text>

        <!-- 5: API -> DB / Evidence (to the right) -->
        <line x1="800" y1="160" x2="1060" y2="160" stroke="#ff7ab6" stroke-width="2" marker-end="url(#arrow2)" />
        <circle cx="930" cy="152" r="10" fill="#ff7ab6" />
        <text x="930" y="155" text-anchor="middle" class="badge">5</text>
          <!-- dashed arrow from Docker Compose to Ingress (ends at Ingress left edge) -->
            <!-- single dashed arrow from Docker Compose to Ingress (ends at Ingress left edge) -->
            <!-- (removed duplicate/overlapping dashed arrow) -->
      </g>

      <!-- Development lane: Docker Compose simplified (moved right to avoid overlap) -->
      <g>
        <!-- compact Docker Compose box centered at x=700 -->
        <rect x="520" y="360" width="360" height="160" rx="8" class="box box-strong"/>
        <text x="700" y="392" text-anchor="middle" class="small" style="font-weight:700">Docker Compose (local)</text>
        <text x="700" y="412" text-anchor="middle" class="dev-small">React, FastAPI, DB (SQLite/Postgres), Traefik</text>
        <text x="700" y="432" text-anchor="middle" class="dev-small">Annotations: local testing · mock auth · GPU optional</text>

        <!-- dotted local test arrow to Ingress (illustrative only, curved up and shortened) -->
        <defs>
          <marker id="arrow-dot" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
            <path d="M 0 0 L 10 5 L 0 10 z" fill="#9ca3af" />
          </marker>
        </defs>
        <path d="M 640 520 C 600 420 520 300 360 152" stroke="#9ca3af" stroke-width="1.6" stroke-dasharray="6 4" fill="none" marker-end="url(#arrow-dot)" />
        <text x="560" y="360" class="small">local testing → simulated ingress</text>
      </g>

      <!-- Legend for numbered arrows (placed bottom-right) -->
      <g>
        <rect x="40" y="430" width="520" height="92" rx="8" fill="#ffffff" stroke="#eef5fb"/>
        <text x="60" y="456" class="small" style="font-weight:700">Legend</text>
        <text x="110" y="456" class="small">1 — CI/CD pushes signed images to Registry</text>
        <text x="110" y="474" class="small">2 — Registry → Cluster deploy</text>
        <text x="110" y="492" class="small">3 — Internet → Ingress (TLS + external auth)</text>
        <text x="360" y="456" class="small">4 — Ingress → API</text>
        <text x="360" y="474" class="small">5 — API → DB / Evidence store (encrypted)</text>
      </g>

      <!-- footer notes -->
      <text x="40" y="526" class="small">Notes: Node pools separate GPU and general workloads; shared observability & secrets; diagrams are illustrative.</text>

    </svg>
  </div>
</body>
</html>